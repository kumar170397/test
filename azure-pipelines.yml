jobs:
- job: Create_Jira_Issue
  displayName: 'Create Jira Issue from Work Item'
  pool:
    vmImage: 'ubuntu-latest'
  
  steps:
  - script: |
      #!/bin/bash
      echo "Starting Jira issue creation..."

      # Jira Credentials (Using Secure Variables)
      JIRA_BASE_URL="https://your-domain.atlassian.net"
      JIRA_PROJECT_KEY="YOUR_PROJECT_KEY"
      JIRA_USER_EMAIL="$(JIRA_USER_EMAIL)"
      JIRA_API_TOKEN="$(JIRA_API_TOKEN)"

      # Work Item Data (Replace this with actual work item details)
      WORK_ITEM_TITLE="New Work Item from Azure DevOps"
      WORK_ITEM_DESCRIPTION="Automatically created from Azure DevOps pipeline"
      WORK_ITEM_TYPE="Task"

      # Create JSON Payload
      JIRA_PAYLOAD=$(cat <<EOF
      {
        "fields": {
          "project": { "key": "$JIRA_PROJECT_KEY" },
          "summary": "$WORK_ITEM_TITLE",
          "description": "$WORK_ITEM_DESCRIPTION",
          "issuetype": { "name": "$WORK_ITEM_TYPE" }
        }
      }
      EOF
      )

      # Send API Request to Jira
      RESPONSE=$(curl --request POST \
        --url "$JIRA_BASE_URL/rest/api/3/issue" \
        --user "$JIRA_USER_EMAIL:$JIRA_API_TOKEN" \
        --header "Accept: application/json" \
        --header "Content-Type: application/json" \
        --data "$JIRA_PAYLOAD")

      echo "JIRA RESPONSE: $RESPONSE"
    displayName: 'Run Bash Script to Create Jira Issue'

